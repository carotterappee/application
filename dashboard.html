<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HP+ - Tableau de bord</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Syne:wght@700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css?v=dashboard-v2"/>
  <style>
    /* ‚Äî mini styles sp√©cifiques au dashboard (peuvent rester ici) ‚Äî */
    #dashboard { max-width: 1040px; margin: 28px auto; padding: 0 20px; position:relative; }
    .dash-top{ position:relative; padding: 8px 0 18px; padding-right: 160px; }
    .dash-welcome{
      font-family:"Syne", system-ui, sans-serif; font-weight:800;
      font-size: clamp(22px, 4vw, 34px); color:#3446d4; margin: 10px 0 0;
    }
    .dash-sub{ color:#667085; margin:6px 0 0; }
    .dash-mascot{ position:absolute; right:16px; top:-10px; width:120px; height:120px; pointer-events:none; }
    @media (max-width:640px){
      .dash-top{ padding-right:112px; }
      .dash-mascot{ width:96px; height:96px; top:-4px; right:10px; }
    }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand">HP+</div>
    <button class="icon-btn settings-btn" onclick="openSettings()" aria-label="Param√®tres"></button>
  </header>

  <main id="dashboard">

    <!-- En-t√™te + mascotte -->
    <div class="dash-top">
      <div class="dash-mascot" aria-hidden="true">
        <!-- Mini mascotte chat avec queue -->
        <svg viewBox="0 0 220 220" class="mascot-svg" role="img" aria-label="Chat noir kawaii">
          <defs>
            <style>
              .fur { fill:#0b0b0e; }
              .eye { fill:#ffe0a8; }
              .pupil { fill:#111; }
              .nose { fill:#2b2b2b; }
              .bow  { fill:#ff66a6; }
              .bow-dark { fill:#ff4d98; }
              .scarf { fill:#ff6fae; }
              .scarf2{ fill:#ff5ea2; }
              @keyframes blink {0%,96%,100%{transform:scaleY(1);}97%,99%{transform:scaleY(.1);} }
            </style>
          </defs>
          <!-- Queue -->
          <path d="M150,160 q20,10 10,30 q-15,18 -30,6"
                fill="none" stroke="#0b0b0e" stroke-width="16" stroke-linecap="round"/>
          <g transform="translate(0,6)">
            <ellipse class="fur" cx="110" cy="142" rx="50" ry="58"/>
            <g transform="translate(0,-10)">
              <circle class="fur" cx="110" cy="78" r="46"/>
              <!-- Oreilles -->
              <path class="fur" d="M80,56 l-15,-16 a6,6 0 0 1 8,-8 l18,12z"/>
              <path class="fur" d="M140,56 l15,-16 a6,6 0 0 0 -8,-8 l-18,12z"/>
              <!-- Noeud -->
              <g transform="translate(122,38) rotate(-8)">
                <ellipse class="bow" cx="0" cy="0" rx="7" ry="5"/>
                <path class="bow-dark" d="M-7,0 C-16,-6,-15,8,-7,5 C-12,10,-10,16,-3,8 Z"/>
                <path class="bow-dark" d="M7,0 C16,-6,15,8,7,5 C12,10,10,16,3,8 Z"/>
              </g>
              <!-- Yeux -->
              <g transform="translate(86,78)">
                <g style="transform-origin:0 0; animation: blink 4.6s infinite;">
                  <circle class="eye" cx="0" cy="0" r="10"/>
                </g>
                <circle class="pupil" cx="0" cy="0" r="4"/>
              </g>
              <g transform="translate(134,78)">
                <g style="transform-origin:0 0; animation: blink 5.1s infinite .12s;">
                  <circle class="eye" cx="0" cy="0" r="10"/>
                </g>
                <circle class="pupil" cx="0" cy="0" r="4"/>
              </g>
              <ellipse class="nose" cx="110" cy="92" rx="4" ry="3"/>
            </g>
            <!-- √âcharpe -->
            <g>
              <path class="scarf" d="M78,116 q32,-10 64,0 q-8,12 -32,12 q-24,0 -32,-12z"/>
              <path class="scarf2" d="M142,118 q10,12 -4,26 q-10,12 -16,2"/>
            </g>
          </g>
        </svg>
      </div>

      <h1 id="dashWelcome" class="dash-welcome" style="display:none;"></h1>
      <p id="dashSub" class="dash-sub" style="display:none;">Ravi de te revoir, pr√™t(e) √† continuer ?</p>
    </div>

    <!-- Grille de stats (XP + Streak) -->
    <section class="stats-grid">
      <div class="card">
        <div class="card-title">XP du jour</div>
        <div class="stars" id="xpStars"></div>
        <div class="muted small">Objectif : <span id="xpTarget">50</span> XP</div>
      </div>

      <div class="card">
        <div class="card-title">Momentum</div>
        <div class="streak-row">
          <div class="flame l1" id="streakFlame"></div>
          <div class="streak-days"><span id="streakDays">0</span> jours d‚Äôaffil√©e</div>
        </div>
        <div class="muted small">Garde le rythme üîÅ</div>
      </div>
    </section>

    <!-- CTA principal -->
    <section class="primary-cta two-btns">
      <button id="lessonBtn" class="btn-big" onclick="startOrContinue()">Commencer ta le√ßon</button>
      <button id="testBtn" class="btn-big secondary" onclick="startTest()">Test de niveau</button>
    </section>

    <!-- Modules (placeholders) -->
    <section class="modules">
      <h2 class="h2">Continuer o√π tu t‚Äôes arr√™t√©</h2>
      <div class="modules-grid">
        <article class="module-card">
          <div class="module-title">Le√ßon 1 ¬∑ Salutations</div>
          <div class="progress"><div class="bar" style="width: 60%"></div></div>
          <button class="mini" onclick="openLesson('lesson-1')">Ouvrir</button>
        </article>
        <article class="module-card">
          <div class="module-title">Le√ßon 2 ¬∑ Chiffres</div>
          <div class="progress"><div class="bar" style="width: 20%"></div></div>
          <button class="mini" onclick="openLesson('lesson-2')">Ouvrir</button>
        </article>
        <article class="module-card">
          <div class="module-title">Le√ßon 3 ¬∑ Famille</div>
          <div class="progress"><div class="bar" style="width: 0%"></div></div>
          <button class="mini" onclick="openLesson('lesson-3')">Ouvrir</button>
        </article>
      </div>
    </section>

    <!-- Actions rapides -->
    <section class="quick-actions">
      <button class="ghost mini" onclick="alert('Test de niveau √† venir')">Test de niveau</button>
      </section>
  </main>

  <script>
    // ---- Bienvenue conditionnelle
    (function initWelcome(){
      let prof = null;
      try{ prof = JSON.parse(localStorage.getItem('hp_profile') || 'null'); }catch(e){}
      const welcome = document.getElementById('dashWelcome');
      const sub = document.getElementById('dashSub');

      if(prof && !prof.guest && prof.displayName){
        welcome.textContent = `Bienvenue sur ton espace, ${prof.displayName} !`;
        welcome.style.display = 'block';
        sub.style.display = 'block';
      } else {
        welcome.style.display = 'none';
        sub.style.display = 'none';
      }
    })();

    // ---- Progression locale & CTA
    function getProgress(){
      try{
        const raw = localStorage.getItem('hp_progress');
        if(raw) return JSON.parse(raw);
      }catch(e){}
      const initial = { started:false, lastLessonId:null, updatedAt:null, xpToday: 0, xpTarget: 50, streakDays: 0 };
      localStorage.setItem('hp_progress', JSON.stringify(initial));
      return initial;
    }
    function setProgress(p){ localStorage.setItem('hp_progress', JSON.stringify(p)); }

    (function initLessonCta(){
      const btn = document.getElementById('lessonBtn');
      const prog = getProgress();
      btn.textContent = prog.started ? 'Continuer ta le√ßon' : 'Commencer ta le√ßon';
    })();

    function startOrContinue(){
      const prog = getProgress();
      if(!prog.started){
        prog.started = true;
        prog.lastLessonId = 'lesson-1';
      }
      prog.updatedAt = new Date().toISOString();
      setProgress(prog);
      // TODO: page de cours r√©elle
      // window.location.href = 'lesson.html';
      alert(prog.started ? 'On reprend ta le√ßon.' : 'On commence la le√ßon 1 !');
    }

    function openLesson(id){
      const prog = getProgress();
      prog.started = true;
      prog.lastLessonId = id;
      prog.updatedAt = new Date().toISOString();
      setProgress(prog);
      // TODO: navigation
      // window.location.href = `${id}.html`;
      alert('Ouverture: ' + id);
    }

    function logout(){
      localStorage.removeItem('hp_profile');
      // on ne supprime pas la progression pour l‚Äôinstant
      window.location.href = 'index.html';
    }

    // ---- Rendu XP (√©toiles argent√©es) & Streak (flamme)
    function renderXpStars(xpToday, xpTarget = 50){
      const count = Math.max(0, Math.min(5, Math.round((xpToday/xpTarget)*5)));
      const wrap = document.getElementById('xpStars'); wrap.innerHTML='';
      for(let i=0;i<5;i++){
        const s = document.createElement('span');
        s.className = 'star' + (i < count ? ' filled' : '');
        wrap.appendChild(s);
      }
      document.getElementById('xpTarget').textContent = xpTarget;
    }
    function updateStreak(days){
      const el = document.getElementById('streakFlame');
      const t = document.getElementById('streakDays');
      if(t) t.textContent = days;
      const lvl = days>=30 ? 5 : days>=14 ? 4 : days>=7 ? 3 : days>=3 ? 2 : 1;
      el.className = 'flame l' + lvl;
    }

    // ---- Init widgets (donn√©es simul√©es pour l‚Äôinstant)
    (function initWidgets(){
      const p = getProgress();
      // Valeurs par d√©faut si absentes
      const xp = typeof p.xpToday === 'number' ? p.xpToday : 34;
      const target = typeof p.xpTarget === 'number' ? p.xpTarget : 50;
      const streak = typeof p.streakDays === 'number' ? p.streakDays : 4;
      renderXpStars(xp, target);
      updateStreak(streak);
    })();
    function openSettings(){
    window.location.href = "settings.html";
  }

  function startTest(){
    alert("Lancement du test de niveau (√† d√©velopper) !");
   } 
  </script>
</body>
</html>

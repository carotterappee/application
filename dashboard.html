<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HP+ - Tableau de bord</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Syne:wght@700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css?v=dashboard-1"/>
  <style>
    #dashboard { max-width: 960px; margin: 28px auto; padding: 0 20px; position:relative; }

      /* réservez de la place pour la mascotte pour que le titre ne passe pas dessous */
    .dash-top {
     position:relative;
     padding: 8px 0 18px;
     padding-right: 160px;        /* ← AJOUT */
     }
    .dash-welcome {
      font-family:"Syne", system-ui, sans-serif;
      font-weight:800;
      font-size: clamp(22px, 4vw, 34px);
      color:#3446d4;
      margin: 10px 0 0;
    }

    /* décale légèrement la mascotte vers la droite */
    .dash-mascot { 
    position:absolute;
    right:16px; 
    top:-10px; 
    width:120px; height:120px; 
    pointer-events:none; 
  }
    @media (max-width:640px){ 
    .dash-top{ padding-right:112px; }  /* ← moins d’espace sur mobile */
    .dash-mascot{ width:96px; height:96px; top:-4px; right:10px; } 
  }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand">HP+</div>
  </header>

  <main id="dashboard">
    <div class="dash-top">
      <!-- Mascotte en haut à droite -->
      <div class="dash-mascot" aria-hidden="true">
        <!-- Mini mascotte chat -->
        <svg viewBox="0 0 220 220" class="mascot-svg" role="img" aria-label="Chat noir kawaii">
          <defs>
            <style>
              .fur { fill:#0b0b0e; }
              .eye { fill:#ffe0a8; }
              .pupil { fill:#111; }
              .nose { fill:#2b2b2b; }
              .bow  { fill:#ff66a6; }
              .bow-dark { fill:#ff4d98; }
              .scarf { fill:#ff6fae; }
              .scarf2{ fill:#ff5ea2; }
              @keyframes blink {0%,96%,100%{transform:scaleY(1);}97%,99%{transform:scaleY(.1);} }
            </style>
          </defs>

          <!-- Queue -->
          <path d="M150,160 q20,10 10,30 q-15,18 -30,6"
                fill="none" stroke="#0b0b0e" stroke-width="16" stroke-linecap="round"/>
          
            <g transform="translate(0,6)">
            <ellipse class="fur" cx="110" cy="142" rx="50" ry="58"/>
            <g transform="translate(0,-10)">
              <circle class="fur" cx="110" cy="78" r="46"/>
              <!-- Oreilles -->
              <path class="fur" d="M80,56 l-15,-16 a6,6 0 0 1 8,-8 l18,12z"/>
              <path class="fur" d="M140,56 l15,-16 a6,6 0 0 0 -8,-8 l-18,12z"/>
              <!-- Noeud -->
              <g transform="translate(122,38) rotate(-8)">
                <ellipse class="bow" cx="0" cy="0" rx="7" ry="5"/>
                <path class="bow-dark" d="M-7,0 C-16,-6,-15,8,-7,5 C-12,10,-10,16,-3,8 Z"/>
                <path class="bow-dark" d="M7,0 C16,-6,15,8,7,5 C12,10,10,16,3,8 Z"/>
              </g>
              <!-- Yeux -->
              <g transform="translate(86,78)">
                <g style="transform-origin:0 0; animation: blink 4.6s infinite;">
                  <circle class="eye" cx="0" cy="0" r="10"/>
                </g>
                <circle class="pupil" cx="0" cy="0" r="4"/>
              </g>
              <g transform="translate(134,78)">
                <g style="transform-origin:0 0; animation: blink 5.1s infinite .12s;">
                  <circle class="eye" cx="0" cy="0" r="10"/>
                </g>
                <circle class="pupil" cx="0" cy="0" r="4"/>
              </g>
              <ellipse class="nose" cx="110" cy="92" rx="4" ry="3"/>
            </g>
            <!-- Écharpe -->
            <g>
              <path class="scarf" d="M78,116 q32,-10 64,0 q-8,12 -32,12 q-24,0 -32,-12z"/>
              <path class="scarf2" d="M142,118 q10,12 -4,26 q-10,12 -16,2"/>
            </g>
          </g>
        </svg>
      </div>

      <!-- Message de bienvenue (affiché seulement si signup/login) -->
      <h1 id="dashWelcome" class="dash-welcome" style="display:none;"></h1>
    </div>

    <!-- Contenu principal -->
    <section class="cta" style="margin-top:20px; text-align:center;">
      <button id="lessonBtn" onclick="startOrContinue()">Continuer ta leçon</button>
    </section>
  </main>

  <script>
    // Lire le profil depuis localStorage
    (function initWelcome(){
      let prof = null;
      try{ prof = JSON.parse(localStorage.getItem('hp_profile') || 'null'); }catch(e){}
      const welcome = document.getElementById('dashWelcome');

      // Conditions : afficher SI non-invité ET displayName connu
      if(prof && !prof.guest && prof.displayName){
        welcome.textContent = `Bienvenue sur ton espace, ${prof.displayName} !`;
        welcome.style.display = 'block';
      } else {
        // Invité ou pas de nom => rien
        welcome.style.display = 'none';
      }
    })();
  </script>

<!-- Nouveau script pour gérer le bouton leçon -->
<script>
  // --- Progression locale ---
  function getProgress(){
    try{
      const raw = localStorage.getItem('hp_progress');
      if(raw) return JSON.parse(raw);
    }catch(e){}
    // valeur par défaut si pas encore de progression
    const initial = { started:false, lastLessonId:null, updatedAt:null };
    localStorage.setItem('hp_progress', JSON.stringify(initial));
    return initial;
  }
  function setProgress(p){
    localStorage.setItem('hp_progress', JSON.stringify(p));
  }

  // Initialise le libellé du bouton
  (function initLessonCta(){
    const btn = document.getElementById('lessonBtn');
    const prog = getProgress();
    btn.textContent = prog.started ? 'Continuer ta leçon' : 'Commencer ta leçon';
  })();

  // Action du bouton
  function startOrContinue(){
    const prog = getProgress();
    if(!prog.started){
      prog.started = true;
      prog.lastLessonId = 'lesson-1';
      prog.updatedAt = new Date().toISOString();
      setProgress(prog);
    } else {
      prog.updatedAt = new Date().toISOString();
      setProgress(prog);
    }
    // TODO: rediriger vers la vraie page de cours
    window.location.href = 'lesson.html';
  }
</script>

</body>
</html>

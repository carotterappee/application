<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HP+ - Apprentissage de langues</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Syne:wght@700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css" />
  <noscript><style>#loader{display:none!important}.fade{opacity:1!important;transform:none!important}</style></noscript>
</head>
<body class="preload">
  <!-- Loader luge -->
  <div id="loader" aria-hidden="true">
    <div class="loader-track">
      <svg class="sled-svg" viewBox="0 0 420 180" role="img" aria-label="Chat en luge">
        <defs>
          <linearGradient id="woodGrad" x1="0" x2="1" y1="0" y2="0">
            <stop offset="0"  stop-color="#9c6d3a"/>
            <stop offset="1"  stop-color="#b8834b"/>
          </linearGradient>
          <linearGradient id="metalGrad" x1="0" x2="0" y1="0" y2="1">
            <stop offset="0"  stop-color="#e7ecf5"/>
            <stop offset="1"  stop-color="#b7c2d5"/>
          </linearGradient>
          <radialGradient id="shadowGrad" cx="50%" cy="50%" r="50%">
            <stop offset="0" stop-color="rgba(0,0,0,.25)"/>
            <stop offset="1" stop-color="rgba(0,0,0,0)"/>
          </radialGradient>
        </defs>
        <rect x="0" y="140" width="420" height="40" fill="#eef5ff"/>
        <ellipse class="sled-shadow" cx="200" cy="148" rx="80" ry="12" fill="url(#shadowGrad)"/>
        <g class="sled">
          <!-- Patins métal -->
<g transform="translate(40,0)">
  <path d="M40,138 q40,0 80,-6 q38,-6 76,0 q6,2 8,6 q-18,4 -32,4 q-46,0 -92,8 q-10,2 -22,2 q-14,0 -24,-4 q-8,-3 -12,-7 q10,-3 18,-3z" fill="url(#metalGrad)"/>
  <path d="M40,130 q76,-12 152,0 q10,2 16,8 q-10,6 -24,8 q-64,10 -128,10 q-18,0 -30,-4 q14,-8 24,-10z" fill="url(#metalGrad)"/>
  <circle cx="210" cy="136" r="6" fill="#c6cfde"/>
  <circle cx="210" cy="146" r="6" fill="#c6cfde"/>
</g>

<!-- Lattes bois -->
<g transform="translate(60,0)">
  <rect x="0" y="116" width="210" height="6" rx="3" fill="#a9b6cc" opacity=".6"/>
  <rect x="0" y="126" width="210" height="6" rx="3" fill="#a9b6cc" opacity=".6"/>
  <g>
    <rect x="2"   y="100" width="38" height="12" rx="6" fill="url(#woodGrad)"/>
    <rect x="44"  y="98"  width="38" height="14" rx="7" fill="url(#woodGrad)"/>
    <rect x="86"  y="96"  width="38" height="16" rx="8" fill="url(#woodGrad)"/>
    <rect x="128" y="98"  width="38" height="14" rx="7" fill="url(#woodGrad)"/>
    <rect x="170" y="100" width="38" height="12" rx="6" fill="url(#woodGrad)"/>
  </g>
</g>

<!-- Cordon -->
<g transform="translate(256,92)">
  <path d="M0,0 q26,-10 36,10 q8,16 -8,22 q-14,6 -20,-4" stroke="#c6cfde" stroke-width="3" fill="none"/>
</g>
          <g transform="translate(120,40)">
            <ellipse cx="40" cy="60" rx="26" ry="32" fill="#0b0b0e"/>
            <circle cx="40" cy="36" r="20" fill="#0b0b0e"/>
            <path d="M28,24 l-8,-8 a5,5 0 0 1 6,-6 l9,6z" fill="#0b0b0e"/>
            <path d="M52,24 l8,-8 a5,5 0 0 0 -6,-6 l-9,6z" fill="#0b0b0e"/>
            <g transform="translate(31,36)">
              <circle r="5.6" fill="#ffe0a8"/>
              <circle r="2.2" fill="#111"/>
            </g>
            <g transform="translate(49,36)">
              <circle r="5.6" fill="#ffe0a8"/>
              <circle r="2.2" fill="#111"/>
            </g>
            <ellipse cx="40" cy="42" rx="1.5" ry="1.2" fill="#2b2b2b"/>
          </g>
        </g>
      </svg>
    </div>
    <div class="loading-label">Loading…</div>
  </div>

  <!-- Header -->
  <header class="topbar">
    <div class="brand">HP+</div>
  </header>

  <!-- Accueil -->
  <main id="heroCenter" class="fade">
    <section id="welcome" class="welcome-card">
      <div class="hero-mascot">
        <svg class="mascot-svg" viewBox="0 0 220 220" role="img" aria-label="Chat noir kawaii">
          <defs>
            <style>
              .fur { fill:#0b0b0e; }
              .eye { fill:#ffe0a8; }
              .pupil { fill:#111; }
              .nose { fill:#2b2b2b; }
              .bow  { fill:#ff66a6; }
              .bow-dark { fill:#ff4d98; }
              .pad  { fill:#f3d3da; }
              .scarf { fill:#ff6fae; }
              .scarf2{ fill:#ff5ea2; }
              @keyframes blink {0%,96%,100%{transform:scaleY(1);}97%,99%{transform:scaleY(.1);} }
              @keyframes wave {0%,100%{transform:rotate(0);}50%{transform:rotate(-12deg);} }
              @keyframes scarfFloat {0%,100%{transform:rotate(4deg);}50%{transform:rotate(-6deg);} }
            </style>
          </defs>
          <ellipse cx="110" cy="198" rx="44" ry="10" fill="#e9eefc"/>
          <path d="M150,160 q20,10 10,30 q-15,18 -30,6" fill="none" stroke="#0b0b0e" stroke-width="16" stroke-linecap="round"/>
          <g transform="translate(0,6)">
            <ellipse class="fur" cx="110" cy="142" rx="50" ry="58"/>
            <g transform="translate(0,-10)">
              <circle class="fur" cx="110" cy="78" r="46"/>

                <!-- Oreilles -->
  <path class="fur" d="M80,56 l-15,-16 a6,6 0 0 1 8,-8 l18,12z"/>
  <path class="fur" d="M140,56 l15,-16 a6,6 0 0 0 -8,-8 l-18,12z"/>

              <g transform="translate(122,38) rotate(-8)">
                <ellipse class="bow" cx="0" cy="0" rx="7" ry="5"/>
                <path class="bow-dark" d="M-7,0 C-16,-6,-15,8,-7,5 C-12,10,-10,16,-3,8 Z"/>
                <path class="bow-dark" d="M7,0 C16,-6,15,8,7,5 C12,10,10,16,3,8 Z"/>
              </g>
              <g transform="translate(86,78)">
                <g style="transform-origin:0 0; animation: blink 4.6s infinite;">
                  <circle class="eye" cx="0" cy="0" r="10"/>
                </g>
                <circle class="pupil" cx="0" cy="0" r="4"/>
              </g>
              <g transform="translate(134,78)">
                <g style="transform-origin:0 0; animation: blink 5.1s infinite .12s;">
                  <circle class="eye" cx="0" cy="0" r="10"/>
                </g>
                <circle class="pupil" cx="0" cy="0" r="4"/>
              </g>
              <ellipse class="nose" cx="110" cy="92" rx="4" ry="3"/>
            </g>
            <g>
              <path class="scarf" d="M78,116 q32,-10 64,0 q-8,12 -32,12 q-24,0 -32,-12z"/>
              <path class="scarf2" d="M142,118 q10,12 -4,26 q-10,12 -16,2"
                    style="transform-origin:140px 118px; animation: scarfFloat 2.4s ease-in-out infinite;"/>
            </g>
          </g>
        </svg>
      </div>
      <div class="hero-text">
        <h1>Bonjour, bienvenue sur HP+</h1>
        <p>Apprends les langues pas à pas.</p>
        <div class="btn-row">
          <button onclick="goToLogin('login')">Se connecter</button>
          <button onclick="goToLogin('signup')">Créer un compte</button>
          <button class="ghost" onclick="guestMode()">Continuer en invité</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Panneaux -->
  <section id="panel-login" class="panel">
    <div class="panel-card">
      <h2>Connexion</h2>
      <div class="form">
        <input type="email" placeholder="Email" autocomplete="email" />
        <input type="password" placeholder="Mot de passe" autocomplete="current-password" />
      </div>
      <div class="actions">
        <button onclick="redirectDashboard('login')">Connexion</button>
        <span class="spacer"></span>
        <button class="ghost" onclick="closePanel()">← Retour</button>
      </div>
    </div>
  </section>

  <section id="panel-signup" class="panel">
  <div class="panel-card">
    <h2>Créer un compte</h2>
    <p class="helper">Bienvenue dans l’aventure HP+ ✨</p>
    <div class="form">
      <input id="su-first" type="text" placeholder="Prénom" autocomplete="given-name" />
      <input id="su-last"  type="text" placeholder="Nom" autocomplete="family-name" />
      <input id="su-nick"  type="text" placeholder="Surnom (optionnel)" />
      <input id="su-mail"  type="email" placeholder="Email" autocomplete="email" />
      <input id="su-pass"  type="password" placeholder="Mot de passe" autocomplete="new-password" />
    </div>
    <div class="actions">
      <button onclick="redirectDashboard('signup')">Créer mon compte</button>
      <span class="spacer"></span>
      <button class="ghost" onclick="closePanel()">← Retour</button>
    </div>
  </div>
</section>

  <section id="panel-guest" class="panel">
    <div class="panel-card">
      <h2>Choisis tes langues</h2>
      <div class="form">
        <label>Langue(s) parlée(s)</label>
        <div class="lang-pills">
          <input class="pill-input" type="checkbox" id="lp-fr" value="Français"><label class="pill" for="lp-fr">Français</label>
          <input class="pill-input" type="checkbox" id="lp-en" value="English"><label class="pill" for="lp-en">English</label>
        </div>
        <label>Langue à apprendre</label>
        <select id="learn-lang">
          <option>Français</option>
          <option>English</option>
        </select>
      </div>
      <div class="actions">
        <button onclick="redirectDashboard('guest')">Continuer</button>
        <span class="spacer"></span>
        <button class="ghost" onclick="closePanel()">← Retour</button>
      </div>
    </div>
  </section>

  <section id="panel-level" class="panel">
    <div class="panel-card">
      <h2>Ton point de départ</h2>
      <div class="actions" style="gap:10px; flex-wrap: wrap;">
        <button onclick="redirectDashboard('guest')">Je suis débutant(e)</button>
        <button onclick="redirectDashboard('guest')">J’ai déjà des bases</button>
        <span class="spacer"></span>
        <button class="ghost" onclick="closePanel()">← Retour</button>
      </div>
    </div>
  </section>

  <script>
    // ===== Loader & redirection vers login =====
    let goingToLogin = false;

    // Empêche le hero d'apparaître si on part vers la page de login
  function showHero(){
    if (goingToLogin) return // si on part vers login, ne pas afficher le hero 
    const loader = document.getElementById('loader');
    const hero = document.getElementById('heroCenter');
    if (loader) loader.classList.add('hide');
    document.body.classList.remove('preload');
    if (hero) hero.classList.add('show');
  }

  // Laisse Le Loader un peu plus longtemps 
  window.addEventListener('load', ()=> setTimeout(showHero, 2400));
  setTimeout(showHero, 4000); // filet de sécurité

  //Redirection propre vers la page de connexion 
  function goToLogin (mode = 'login'){
    goingToLogin = true; 
    window.location.href = `login.html?mode=${mode}`;
    }
  window.goToLogin = goToLogin; // pour les onclick des boutons 

  // ===== panneaux =====
  function openPanel(id){
    document.body.classList.add('panel-open');
    document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
    document.getElementById(id)?.classList.add('active');
  }
  function closePanel(){
    document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
    document.body.classList.remove('panel-open');
  }
  function goToPage(id){
    if(id==='login'){ openPanel('panel-login'); return; }
    if(id==='signup'){ openPanel('panel-signup'); return; }
  }
  
  // Nouveau: une seule fonction pour tout rediriger + stocker le profil
  function redirectDashboard(mode){
    try{
      // si aucun mode n'est passé, on considère "guest" (pour compat)
      if(!mode) mode = 'guest';

      let profile = { guest:false, displayName:null };

      if(mode === 'signup'){
        const first = (document.getElementById('su-first')?.value || '').trim();
        const nick  = (document.getElementById('su-nick')?.value || '').trim();
        const disp  = nick || first || null; // surnom prioritaire sinon prénom
        profile.displayName = disp;
        profile.guest = false;

      } else if(mode === 'login'){
        // Sans backend: on réutilise un profil existant si disponible
        const existing = JSON.parse(localStorage.getItem('hp_profile') || 'null');
        if(existing && existing.displayName){ profile.displayName = existing.displayName; }
        profile.guest = false;

      } else if(mode === 'guest'){
        profile.guest = true;
        profile.displayName = null; // pas de bienvenue en mode invité
      }

      // Merge avec ancien profil s'il existe
      const prev = JSON.parse(localStorage.getItem('hp_profile') || 'null') || {};
      localStorage.setItem('hp_profile', JSON.stringify({ ...prev, ...profile }));
    }catch(e){
      console.warn('profile save error', e);
    }

    // Redirection finale
    window.location.href = "dashboard.html";
  }

  // Compat: l'ancien bouton "Continuer en invité" peut garder guestMode()
  function guestMode(){ redirectDashboard('guest'); }
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Coffre ‚Äî HP+</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Syne:wght@700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css?v=chest-v1"/>
  <style>
    #chestPage{ max-width: 1040px; margin: 26px auto; padding: 0 20px; }
    .chest-top{
      display:flex; align-items:center; gap:12px; margin-bottom:12px;
    }
    .chest-top .title{
      font-family:"Syne", system-ui, sans-serif; font-weight:800;
      font-size: clamp(22px, 4vw, 34px); color:#3446d4;
    }
    .tabs{
      display:flex; gap:8px; flex-wrap:wrap; margin: 8px 0 16px;
    }
    .tab-btn{
      padding:10px 14px; border-radius:12px; border:1px solid var(--outline); background:#fff;
      font-weight:700; color:#3f51b5; cursor:pointer;
    }
    .tab-btn.active{
      background:linear-gradient(135deg, var(--primary), #C4CEFF); color:#0F172A; border-color:transparent;
    }
    .grid{
      display:grid; gap:16px; grid-template-columns: repeat(3, minmax(240px,1fr));
    }
    @media (max-width:900px){ .grid{ grid-template-columns: repeat(2, minmax(220px,1fr)); } }
    @media (max-width:640px){ .grid{ grid-template-columns: 1fr; } }
    .card{
      background:#fff; border:1px solid #eef1fb; border-radius:16px; padding:16px;
      box-shadow:0 10px 30px rgba(70,90,200,.10);
    }
    .card-title{ font-weight:800; color:#3f51b5; margin-bottom:10px; }
    .stars-big{ display:flex; gap:10px; flex-wrap:wrap; }
    .star.big{ width:40px; height:40px; }
    .center{ text-align:center; }
    .total-badge{
      display:inline-flex; align-items:center; gap:10px; padding:12px 16px;
      border-radius:14px; border:1px solid #e7ebff; background:#f7f9ff; font-weight:800; color:#2f43c8;
    }
    .row{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .back{ border:none; background:#fff; color:#3f51b5; border:1px solid var(--outline); padding:10px 14px; border-radius:12px; cursor:pointer; }
  
   /* --- Momentum mystique (sans spoiler) --- */
  .mystic-card{
    position:relative;
    overflow:hidden;
    background: radial-gradient(120% 140% at 10% 0%, #f7f9ff 0, #eef3ff 55%, #fef8ff 100%);
  }
  .mystic-wrap{
    display:flex; align-items:center; gap:16px; position:relative;
    min-height:120px;
  }
  .mystic-caption .streak-days{ font-weight:800; color:#2f43c8; }
  .mystic-caption .small{ font-size:.9rem; }

  /* Aura douce derri√®re la flamme */
  .mystic-card .aura{
    position:absolute; left:20px; top:50%; transform:translateY(-50%);
    width:140px; height:140px; border-radius:50%;
    background: radial-gradient(closest-side, rgba(140,160,255,.35), rgba(255,255,255,0));
    filter: blur(14px);
    pointer-events:none;
    animation: auraPulse 3s ease-in-out infinite;
  }
  @keyframes auraPulse{ 0%,100%{opacity:.65; transform:translateY(-50%) scale(1);} 50%{opacity:.9; transform:translateY(-50%) scale(1.06);} }

  /* Grande flamme unique (couleur/tailles g√©r√©es par classes) */
  .flame-large{
    width:64px; height:78px;
    mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.5 0S9 3 9 7c0 3 2.5 4.5 2.5 6.5S9.5 17 9.5 19c0 2.2 1.8 5 5.5 5 3.3 0 6-2.7 6-6 0-6.5-7.5-10.5-7.5-18z"/></svg>') no-repeat center / contain;
    -webkit-mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.5 0S9 3 9 7c0 3 2.5 4.5 2.5 6.5S9.5 17 9.5 19c0 2.2 1.8 5 5.5 5 3.3 0 6-2.7 6-6 0-6.5-7.5-10.5-7.5-18z"/></svg>') no-repeat center / contain;
    background: linear-gradient(180deg,#ffd58a,#ff9a3c 60%,#ff6a00);
    filter: drop-shadow(0 8px 22px rgba(80,120,255,.25));
    animation: breathe 2.4s ease-in-out infinite;
  }
  
  @keyframes breathe{ 0%,100%{transform:translateY(0) scale(1);} 50%{transform:translateY(-2px) scale(1.04);} }

  /* Tailles (selon la s√©rie) */
  .flame-large.s1{ transform-origin:center; }
  .flame-large.s2{ transform: scale(1.15); }
  .flame-large.s3{ transform: scale(1.3); }

  /* Couleurs (selon la s√©rie) */
  .flame-large.red{    background: linear-gradient(180deg,#ffb3a3,#ff6b5e 60%,#ff2d2d); }
  .flame-large.amber{  background: linear-gradient(180deg,#ffe39a,#ffc14e 60%,#ffa800); }
  .flame-large.blue{   background: linear-gradient(180deg,#c7e7ff,#79c0ff 60%,#3192ff); }
  .flame-large.violet{ background: linear-gradient(180deg,#ffc2f2,#ff6ed6 60%,#ff37a8); }

  /* Petite lueur sur la l√©gende de jours */
  .streak-days{ text-shadow:0 1px 0 #fff; }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand" onclick="location.href='dashboard.html'" style="cursor:pointer">HP+</div>
  </header>

  <main id="chestPage">
    <div class="chest-top">
      <button class="back" onclick="history.back()">‚Üê Retour</button>
      <div class="title">Coffre des r√©compenses</div>
      <div class="total-badge" id="totalStars">‚≠ê 0 √©toiles</div>
    </div>

    <div class="tabs">
      <button class="tab-btn active" data-tab="tab-stars">√âtoiles</button>
      <button class="tab-btn" data-tab="tab-streak">Momentum (flammes)</button>
    </div>

    <section id="tab-stars" class="tab-panel">
      <div class="grid">
        <div class="card">
          <div class="card-title">√âtoiles gagn√©es</div>
          <div id="starsWrap" class="stars-big"></div>
        </div>
        <div class="card">
          <div class="card-title">R√©partition (aujourd‚Äôhui)</div>
          <div id="todayStars" class="center muted">‚Äî</div>
        </div>
        <div class="card">
          <div class="card-title">Prochain badge</div>
          <div class="center muted" id="nextBadge">Gagne encore 10 ‚≠ê pour d√©crocher un badge.</div>
        </div>
      </div>
    </section>

    <section id="tab-streak" class="tab-panel" style="display:none;">
  <div class="grid">
    <!-- Carte mystique -->
    <div class="card mystic-card">
      <div class="card-title">Momentum</div>
      <div class="mystic-wrap">
        <div class="aura"></div>
        <div id="bigFlame" class="flame-large"></div>
        <div class="mystic-caption">
          <div class="streak-days" id="streakDaysBox">0 üî•</div>
          <div class="muted small">Ta flamme refl√®te ta r√©gularit√©.</div>
        </div>
      </div>
    </div>

    <!-- Historique -->
    <div class="card">
      <div class="card-title">Historique</div>
      <div id="streakHistory" class="muted">Pas encore d‚Äôhistorique.</div>
    </div>
  </div>
</section>
  </main>

  <script>
    function getRewards(){ try{ return JSON.parse(localStorage.getItem('hp_rewards')||'null')||{} }catch(e){ return {}; } }
    function setRewards(r){ localStorage.setItem('hp_rewards', JSON.stringify(r)); }
    function getProgress(){ try{ return JSON.parse(localStorage.getItem('hp_progress')||'null')||{} }catch(e){ return {}; } }

    // Tabs simple
    document.querySelectorAll('.tab-btn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const t = btn.getAttribute('data-tab');
        document.querySelectorAll('.tab-panel').forEach(p=>p.style.display='none');
        document.getElementById(t).style.display = 'block';
      });
    });

    // Rendu des √©toiles
    function renderStars(){
      const r = getRewards();
      const total = r.starsTotal || 0;
      document.getElementById('totalStars').textContent = `‚≠ê ${total} ${total>1?'√©toiles':'√©toile'}`;

      const wrap = document.getElementById('starsWrap');
      wrap.innerHTML = '';
      const count = Math.min(30, total); // on n‚Äôen affiche qu‚Äôun √©chantillon
      for(let i=0;i<count;i++){
        const s = document.createElement('span');
        s.className = 'star big filled';
        wrap.appendChild(s);
      }

      const d = new Date().toISOString().slice(0,10);
      const today = (r.starsByDay && r.starsByDay[d]) ? r.starsByDay[d] : 0;
      document.getElementById('todayStars').textContent = today ? `${today} ‚≠ê aujourd‚Äôhui` : 'Aucune √©toile gagn√©e aujourd‚Äôhui';

      const next = Math.max(0, 10 - (total % 10));
      document.getElementById('nextBadge').textContent = next ? `Gagne encore ${next} ‚≠ê pour d√©crocher un badge.` : `Bravo ! Tu viens de d√©bloquer un badge üéâ`;
    }

    // Rendu streak
    function renderStreak(){
      const p = getProgress();
      const days = p.streakDays || 0;
      document.getElementById('streakDaysBox').textContent = `${days} üî•`;
      const hist = p.streakHistory || [];
      document.getElementById('streakHistory').textContent = hist.length ? hist.join(', ') : 'Pas encore d‚Äôhistorique.';
    }

    // Init
    renderStars();
    renderStreak();
    function getFlameClass(streak){
  const steps = [
    ['red','s1'], ['red','s2'], ['red','s3'],
    ['amber','s1'], ['amber','s2'], ['amber','s3'],
    ['blue','s1'], ['blue','s2'], ['blue','s3'], ['bluelight','s3'],
    ['pink','s1'], ['pink','s2'], ['pink','s3'],
    ['violet','s1'], ['violet','s2'], ['violet','s3'], ['violetlight','s3']
  ];
  const idx = Math.max(0, ((streak || 1) - 1) % steps.length);
  const [color,size] = steps[idx];
  return `flame-large ${color} ${size}`;
}

// Mets √† jour renderStreak pour utiliser la s√©quence
function renderStreak(){
  const p = getProgress();
  const days = p.streakDays || 0;

  const flame = document.getElementById('bigFlame');
  flame.className = getFlameClass(days > 0 ? days : 1); // par d√©faut, √©tape 1

  document.getElementById('streakDaysBox').textContent = `${days} üî•`;
  const hist = p.streakHistory || [];
  document.getElementById('streakHistory').textContent = hist.length ? hist.join(', ') : 'Pas encore d‚Äôhistorique.';
}
// --- init
renderStars();
renderStreak();
  </script>
</body>
</html>